$(document).ready(function(){function e(e){if($(".add-task").hasClass("active"))var t=$(".add-task.active").data("id");else var t=e.data("id");$.ajax({url:"../functions.php",context:$(this),type:"POST",data:{id_perform:t,action:"perform"},dataType:"HTML",success:function(){$(".add-task.active").children(".case").addClass("perform")}})}function t(e){if($(".add-task").hasClass("active"))var t=$(".add-task.active").data("id");else var t=e.data("id");$.ajax({url:"../functions.php",context:$(this),type:"POST",data:{id_delete:t,action:"delete"},dataType:"HTML",success:function(){$("#"+t).detach()}})}function s(){if($(".add-task").hasClass("active")){console.log("ok");var e=$(".add-task.active").data("id"),t=$(".add-task.active").children(".case").val();$.ajax({url:"../functions.php",context:$(this),type:"POST",data:{id_update:e,text_update:t,action:"update"},dataType:"HTML",success:function(){}})}}function a(e){1==e?$(".count-selected").text("Выбрана "+e+" заметка"):e>=2&&e<=4?$(".count-selected").text("Выбрано "+e+" заметки"):e>=5&&$(".count-selected").text("Выбрано "+e+" заметок")}function c(e){$(".close-bar").css("visibility","hidden"),$(".bar-selected").addClass("fadeOutUp"),$(".wrapper").css("padding-top","20px"),d=0,$(".case").removeClass("selected"),$(".select").hide()}function n(){var e=(new Date).getDay();return-1==--e&&(e=6),e}tippy(".fa-ellipsis-v",{content:"Ещё"}),tippy(".select",{content:"Выбрать заметку"}),tippy(".bar-selected ",{target:".fas"}),tippy(".plus-task",{content:"Добавить заметку",followCursor:!0,theme:"light-border"}),$(document).on("click",".settings-delete",function(e){t($(this))}),$(document).on("click",".perform-bar-selected",function(t){e($(this))}),$(document).on("click",".settings-perform",function(t){e($(this)),$(".settings-perform").detach()}),$(document).keyup(function(s){27==s.keyCode&&t(),s.ctrlKey&&32==s.keyCode&&(e(),$(".settings-perform").detach())}),$(document).on("click",'.success[name="send"]',function(e){var t=$(this).data("day"),s=$(this).parent().prev(".case").val();$.ajax({url:"../functions.php",context:$(this),type:"POST",data:{day_send:t,text_send:s,action:"send"},dataType:"HTML",success:function(e){$(this).parent().prev(".case").parent().next().before(e),$(this).parent().prev(".case").parent().detach()}})}),$(document).on("click",".add-task",function(e){$(this).children(".case").hasClass("active")||($(document).keyup(function(e){s()}),$(".case").removeClass("active"),$(this).children(".case").addClass("active"),$(document).mouseup(function(e){var t=$("#text");t.is(e.target)||0!==t.has(e.target).length||($("body").css("cursor","default"),$(".add-task").children(".case").css("cursor","default"),$(".add-task").removeClass("active"),$(".case").removeClass("active"),$(".show-control").removeClass("active"))})),$(".add-task").hasClass("active")?($(".add-task").children(".case").css("cursor","default"),$(".add-task").removeClass("active"),$(".show-control").removeClass("active"),$(this).children(".case").css("cursor","text"),$(this).addClass("active")):($(this).children(".case").css("cursor","text"),$(this).addClass("active"),$(this).parent().addClass("active"))});var d=0,o=[];$(document).on("click",".select",function(e){$(".close-bar").css("visibility","visible");var t=$(this).next(".case");if(t.hasClass("selected")){var s=o.indexOf($(this).parent().data("id"));o.splice(s,1),t.removeClass("selected"),d--,a(d)}else t.addClass("selected"),d++,a(d),o.push($(this).parent().data("id"));0==d?($(".bar-selected").addClass("fadeOutUp"),$(".wrapper").css("padding-top","20px"),$(".close-bar").css("visibility","hidden")):($(".bar-selected").removeClass("fadeOutUp"),$(".bar-selected").addClass("fadeInDown")),parseInt($(".wrapper").css("padding-top"))<60&&$(".wrapper").css("padding-top","+=90px")}),$(document).on("click",".close-bar-selected",function(e){c(d)}),$(document).on("click",".perform-bar-selected",function(e){$.post("functions.php",{arr_id:JSON.stringify(o),action:"some_perform"},function(){$(".selected").addClass("perform")})}),$(document).on("click",".delete-bar-selected",function(e){$.post("functions.php",{arr_id_delete:JSON.stringify(o),action:"delete_some_task"},function(){for(var e=0;e<o.length;e++)$("#"+o[e]).detach();$(".bar-selected").addClass("fadeOutUp"),$(".wrapper").css("padding-top","20px"),d=0,$(".close-bar").css("visibility","hidden")})}),$(document).on("click",".close-bar",function(e){c(d)}),$(document).on("mouseover",".add-task",function(e){$(this).children(".fa-ellipsis-v").css("display","flex"),$(this).find(".select").css("display","block")}),$(document).on("mouseout",".add-task",function(e){$(this).children(".settings").hasClass("active-settings")||($(this).children(".fa-ellipsis-v").css("display","none"),$(this).find(".case").hasClass("selected")||$(this).find(".select").css("display","none"))}),$(document).on("click",".fa-ellipsis-v",function(e){$(this).next().addClass("active-settings"),$(this).next().addClass("fadeInDown")}),$(document).on("mouseover",".change-day",function(e){$(this).next().addClass("fadeInLeft")}),$(document).mouseup(function(e){var t=$(".active-settings");t.is(e.target)||0!==t.has(e.target).length||(t.prev().css("display","none"),t.removeClass("active-settings"),t.prevAll(".select").css("display","none"))}),$(document).on("click",".cancel",function(){$(this).prev().parent().prev().parent().detach()}),$(document).on("click",".hot-buttons",function(){$(".show-hot-button").toggleClass("active-hot-button"),$(".ham").toggleClass("active")}),function(e){jQuery.fn.lightTabs=function(t){var s=function(){tabs=this,i=0,showPage=function(t){e(tabs).children("div").children("div").hide(),e(tabs).children("div").children("div").eq(t).show(),e(tabs).children("ul").children("li").removeClass("active"),e(tabs).children("ul").children("li").eq(t).addClass("active")},showPage(n()),e(tabs).children("ul").children("li").each(function(t,s){e(s).attr("data-page",i),i++}),e(tabs).children("ul").children("li").click(function(){showPage(parseInt(e(this).attr("data-page")))})};return this.each(s)}}(jQuery),$(".tabs").lightTabs()}),$(document).on("click",".plus-task",function(){var e=$(this).data("day");$(this).before('<form class="add-new-task" action="" method="POST"><textarea class="case" cols="20" rows="4" name="task" autofocus></textarea><div class="check first"><button type="button" name="send" data-day="'+e+'" class="success"><i class="fas fa-check"></i></button><button type="button" class="cancel"><i class="fas fa-times"></i></button></div></form>')});